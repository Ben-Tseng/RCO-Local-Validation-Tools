<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ¹¾èº«ä»½è¯éªŒè¯å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"] {
            width: 95%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            text-transform: uppercase; /* ç¡®ä¿é¦–å­—æ¯å¤§å†™ */
        }
        .result-box {
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #cce7ff;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-label {
            font-weight: bold;
            color: #0056b3;
        }
        .result-value {
            font-weight: bold;
            color: #d9534f; /* çªå‡ºæ˜¾ç¤ºè®¡ç®—ç»“æœ */
            font-size: 1.1em;
        }
        .validation-message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .valid {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .invalid {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info-message {
            font-size: 0.9em;
            color: #888;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ‡¹ğŸ‡¼ å°æ¹¾èº«ä»½è¯éªŒè¯å™¨</h1>
        
        <div class="input-group">
            <label for="nidInput">è¯·è¾“å…¥èº«ä»½è¯å·ç  (NID#)ï¼š</label>
            <input type="text" id="nidInput" maxlength="10" placeholder="ä¾‹å¦‚ï¼šA123456789">
        </div>

        <div class="result-box">
            <div class="result-item">
                <span class="result-label">é€šç®—å€¼ (Sum Value):</span>
                <span class="result-value" id="sumValue"></span>
            </div>
            <div class="result-item">
                <span class="result-label">æœ«ä½æ ¡éªŒç  (Check Code):</span>
                <span class="result-value" id="checkCode"></span>
            </div>
            <div class="result-item">
                <span class="result-label">èº«ä»½è¯æœ«ä½æ•°å­—:</span>
                <span class="result-value" id="lastDigit"></span>
            </div>
        </div>

        <div class="validation-message" id="validationMessage">
            </div>

        <p class="info-message">
            æ€§åˆ«ç ï¼šç”·æ€§ä¸º 1ï¼Œå¥³æ€§ä¸º 2
        </p>

    </div>

    <script>
        // æ ¹æ®æ‚¨ä¸Šä¼ çš„å›¾ç‰‡æ„å»ºæŸ¥æ‰¾è¡¨ï¼ˆè‹±æ–‡ï¼šéªŒè¯ç ï¼‰
        const areaCodeTable = {
            'A': 10, 'B': 11, 'C': 12, 'D': 13, 'E': 14, 'F': 15, 
            'G': 16, 'H': 17, 'I': 34, 'J': 18, 'K': 19, 'L': 20, 
            'M': 21, 'N': 22, 'O': 35, 'P': 23, 'Q': 24, 'R': 25, 
            'S': 26, 'T': 27, 'U': 28, 'V': 29, 'W': 32, 'X': 30, 
            'Y': 31, 'Z': 33
        };

        const nidInput = document.getElementById('nidInput');
        const sumValueDisplay = document.getElementById('sumValue');
        const checkCodeDisplay = document.getElementById('checkCode');
        const lastDigitDisplay = document.getElementById('lastDigit');
        const validationMessage = document.getElementById('validationMessage');

        // ç»‘å®šè¾“å…¥äº‹ä»¶
        nidInput.addEventListener('input', validateNID);
        nidInput.addEventListener('change', validateNID); // ç¡®ä¿åœ¨è¾“å…¥å®Œæˆåä¹Ÿè§¦å‘

        function validateNID() {
            // æ¸…ç†è¾“å…¥å¹¶è½¬ä¸ºå¤§å†™
            let nid = nidInput.value.trim().toUpperCase();
            nidInput.value = nid; // æ›´æ–°è¾“å…¥æ¡†çš„å€¼ä¸ºå¤§å†™

            // 1. éªŒè¯æ ¼å¼
            // å¿…é¡»æ˜¯10ä½ï¼Œé¦–ä½æ˜¯å­—æ¯ï¼Œç¬¬äºŒä½æ˜¯1æˆ–2ï¼Œå…¶ä½™æ˜¯æ•°å­—
            if (!/^[A-Z][12]\d{8}$/.test(nid)) {
                // æ¸…ç©ºç»“æœæ˜¾ç¤º
                sumValueDisplay.textContent = '---';
                checkCodeDisplay.textContent = '---';
                lastDigitDisplay.textContent = '---';
                validationMessage.className = 'validation-message';
                validationMessage.textContent = 'è¯·è¾“å…¥æ­£ç¡®çš„å°æ¹¾èº«ä»½è¯å·ç æ ¼å¼ (10ä½ï¼Œé¦–å­—æ¯ï¼Œç¬¬äºŒä½1/2ï¼Œå8ä½æ•°å­—)';
                return; // æ ¼å¼ä¸æ­£ç¡®åˆ™åœæ­¢è®¡ç®—
            }

            // æå–é¦–å­—æ¯å’ŒéªŒè¯ç 
            const firstChar = nid.charAt(0);
            const areaCodeStr = String(areaCodeTable[firstChar]); // VLOOKUP(LEFT(F2,1),$A:$C,3,0)

            // å¦‚æœæ‰¾ä¸åˆ°åŒºç ï¼Œç†è®ºä¸Šä¸åº”è¯¥å‘ç”Ÿï¼Œä½†ä¸ºäº†å¥å£®æ€§
            if (!areaCodeStr) {
                sumValueDisplay.textContent = '---';
                checkCodeDisplay.textContent = '---';
                lastDigitDisplay.textContent = '---';
                validationMessage.className = 'validation-message invalid';
                validationMessage.textContent = `é”™è¯¯ï¼šæ‰¾ä¸åˆ°å­—æ¯ ${firstChar} çš„åŒºç ã€‚`;
                return;
            }

            // 2. è®¡ç®—é€šç®—å€¼ï¼ˆSum Valueï¼‰
            // å…¬å¼ï¼šMID(VLOOKUP(..),1,1) + MID(VLOOKUP(..),2,1)*9 + MID(F2,2,1)*8 + ... + MID(F2,9,1)*1
            
            // åœ°åŒºç ç¬¬ä¸€ä½ (A0)
            const w1 = parseInt(areaCodeStr.charAt(0)) || 0; // MID(VLOOKUP(..),1,1)
            // åœ°åŒºç ç¬¬äºŒä½ (A1)
            const w2 = parseInt(areaCodeStr.charAt(1)) || 0; // MID(VLOOKUP(..),2,1)

            // æå–èº«ä»½è¯æ•°å­—éƒ¨åˆ† (2-9ä½)
            const N2 = parseInt(nid.charAt(1)); // N2 (æ€§åˆ«ç )
            const N3 = parseInt(nid.charAt(2));
            const N4 = parseInt(nid.charAt(3));
            const N5 = parseInt(nid.charAt(4));
            const N6 = parseInt(nid.charAt(5));
            const N7 = parseInt(nid.charAt(6));
            const N8 = parseInt(nid.charAt(7));
            const N9 = parseInt(nid.charAt(8));
            const N10 = parseInt(nid.charAt(9)); // èº«ä»½è¯æœ«ä½æ•°å­—ï¼ˆç”¨äºæ¯”è¾ƒï¼‰

            // æ‰§è¡ŒåŠ æƒæ±‚å’Œ
            const sumValue = (w1 * 1) + 
                             (w2 * 9) + 
                             (N2 * 8) + 
                             (N3 * 7) + 
                             (N4 * 6) + 
                             (N5 * 5) + 
                             (N6 * 4) + 
                             (N7 * 3) + 
                             (N8 * 2) + 
                             (N9 * 1); // æ³¨æ„ï¼šExcelå…¬å¼ä¸­åªè®¡ç®—åˆ°N9

            sumValueDisplay.textContent = sumValue;

            // 3. è®¡ç®—æœ«ä½æ ¡éªŒç ï¼ˆCheck Codeï¼‰
            // å…¬å¼ï¼š=IFERROR(IF(RIGHT(F3,1)="0",RIGHT(F3,1),10-RIGHT(F3,1)),"")
            // F3 æ˜¯é€šç®—å€¼ï¼ŒRIGHT(F3,1) æ˜¯é€šç®—å€¼æœ«å°¾æ•°å­—ï¼Œå³ sumValue % 10
            
            const remainder = sumValue % 10; // é€šç®—å€¼æœ«å°¾æ•°å­— (RIGHT(F3,1))
            let checkCode;

            if (remainder === 0) {
                // å¦‚æœé€šç®—å€¼æœ«å°¾æ˜¯ 0
                checkCode = 0; // RIGHT(F3,1)
            } else {
                // å¦‚æœé€šç®—å€¼æœ«å°¾ä¸æ˜¯ 0
                checkCode = 10 - remainder; // 10-RIGHT(F3,1)
            }

            checkCodeDisplay.textContent = checkCode;
            lastDigitDisplay.textContent = N10; // èº«ä»½è¯æœ«ä½æ•°å­—

            // 4. éªŒè¯ç»“æœ
            if (N10 === checkCode) {
                validationMessage.className = 'validation-message valid';
                validationMessage.textContent = 'âœ… æ ¡éªŒæˆåŠŸï¼è¯¥èº«ä»½è¯å·ç é€šè¿‡éªŒè¯ã€‚';
            } else {
                validationMessage.className = 'validation-message invalid';
                validationMessage.textContent = `âŒ æ ¡éªŒå¤±è´¥ï¼æœ«ä½æ•°å­— (${N10}) ä¸è®¡ç®—å‡ºçš„æ ¡éªŒç  (${checkCode}) ä¸åŒ¹é…ã€‚`;
            }
        }
        
        // åˆå§‹è¿è¡Œä¸€æ¬¡ï¼Œä»¥è®¾ç½®é»˜è®¤æ˜¾ç¤º
        validateNID();
    </script>

</body>
</html>